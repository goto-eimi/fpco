# 予約システム完全セットアップガイド（ステップバイステップ）

このガイドに従って順番に作業を行うことで、予約システムを確実に動作させることができます。

## 📋 事前準備

### 必要な権限・環境
- [ ] WordPress管理者権限
- [ ] FTPまたはファイルマネージャーへのアクセス
- [ ] データベースへのアクセス（phpMyAdminなど）

## 🚀 Step 1: ファイルの確認

### 1.1 テーマファイルの存在確認
以下のファイルがテーマフォルダ（`wp-content/themes/fpco/`）に存在することを確認：

```
✅ page-reservation-form.php      （予約フォーム）
✅ page-reservation-confirm.php   （入力確認）
✅ page-reservation-complete.php  （予約完了）
✅ page-reservation-print.php     （印刷画面）
✅ assets/js/reservation-form.js  （JavaScript）
```

**確認方法**:
- FTPソフトまたはWordPress管理画面の「外観」→「テーマエディター」で確認

## 🚀 Step 2: パーマリンク設定

### 2.1 パーマリンク設定画面を開く
1. WordPress管理画面にログイン
2. 左メニュー「設定」→「パーマリンク」をクリック

### 2.2 パーマリンク形式を変更
1. **「投稿名」**のラジオボタンを選択
2. ページ下部の**「変更を保存」**をクリック
3. 「パーマリンク構造を更新しました。」メッセージを確認

### 2.3 設定確認
- [ ] 「投稿名」が選択されている
- [ ] プレビューURL欄が `https://your-site.com/sample-post/` 形式になっている
- [ ] エラーメッセージが表示されていない

## 🚀 Step 3: 固定ページの作成

### 3.1 予約フォームページ
1. 「固定ページ」→「新規追加」
2. **タイトル**: 「予約フォーム」と入力
3. **スラッグ設定**:
   - 右パネルの「URL」セクションを開く
   - スラッグ欄に「`reservation-form`」と入力
4. **テンプレート選択**:
   - 右パネルの「テンプレート」セクションを開く
   - 「予約フォーム」を選択
5. **公開**ボタンをクリック

### 3.2 入力確認ページ
1. 「固定ページ」→「新規追加」
2. **タイトル**: 「予約内容確認」と入力
3. **スラッグ**: 「`reservation-confirm`」
4. **テンプレート**: 「予約フォーム確認」を選択
5. **公開**

### 3.3 予約完了ページ  
1. 「固定ページ」→「新規追加」
2. **タイトル**: 「予約完了」と入力
3. **スラッグ**: 「`reservation-complete`」
4. **テンプレート**: 「予約完了」を選択
5. **公開**

### 3.4 印刷ページ
1. 「固定ページ」→「新規追加」
2. **タイトル**: 「予約内容印刷」と入力
3. **スラッグ**: 「`reservation-print`」
4. **テンプレート**: 「予約内容印刷」を選択
5. **公開**

### 3.5 ページ作成確認
「固定ページ」→「固定ページ一覧」で以下4つのページが表示されることを確認：

| タイトル | スラッグ | テンプレート |
|----------|----------|--------------|
| 予約フォーム | reservation-form | 予約フォーム |
| 予約内容確認 | reservation-confirm | 予約フォーム確認 |
| 予約完了 | reservation-complete | 予約完了 |
| 予約内容印刷 | reservation-print | 予約内容印刷 |

## 🚀 Step 4: データベーステーブル作成

### 4.1 phpMyAdminにアクセス
1. サーバーのコントロールパネルからphpMyAdminを開く
2. WordPressで使用しているデータベースを選択

### 4.2 SQLの実行
1. 上部の「SQL」タブをクリック
2. `database_setup.sql`の内容をコピー＆ペースト
3. 「実行」ボタンをクリック

### 4.3 テーブル作成確認
以下のテーブルが作成されていることを確認：
- [ ] `wp_reservations`（予約テーブル）
- [ ] `wp_reservation_agencies`（旅行会社テーブル）

## 🚀 Step 5: 動作テスト

### 5.1 基本アクセステスト
以下のURLに順番にアクセスして、ページが正常に表示されることを確認：

```bash
# 予約フォームページ
https://your-site.com/reservation-form/

# パラメータ付きでのアクセス
https://your-site.com/reservation-form/?factory=1&date=2025-06-01&timeslot=am-60-1
```

**確認ポイント**:
- [ ] 404エラーが表示されない
- [ ] フォームが正常に表示される
- [ ] パラメータ付きアクセスで予約内容が表示される

### 5.2 フォーム動作テスト
1. 予約フォームに適当なデータを入力
2. 必須項目を全て埋める
3. 「入力内容の確認 →」ボタンをクリック
4. 確認画面が表示されることを確認

### 5.3 フル画面遷移テスト
1. 予約フォーム → データ入力
2. 確認画面 → 「この内容で送信する →」クリック
3. 完了画面が表示されることを確認

## 🚀 Step 6: カレンダー連携テスト

### 6.1 カレンダーページの確認
1. カレンダーページ（予約状況カレンダー）にアクセス
2. ○ボタンをクリックして時間帯選択
3. 自動で予約フォームに遷移することを確認

## ❌ トラブルシューティング

### 問題: 404エラーが表示される

**チェックポイント**:
1. [ ] パーマリンク設定が「投稿名」になっているか
2. [ ] 固定ページが正しく作成されているか  
3. [ ] スラッグが正確に設定されているか

**解決手順**:
1. パーマリンク設定を再保存
2. 固定ページのスラッグを再確認
3. `.htaccess`ファイルの権限を確認（644）

### 問題: テンプレートが適用されない

**チェックポイント**:
1. [ ] テーマフォルダにテンプレートファイルが存在するか
2. [ ] Template Nameコメントが正しいか
3. [ ] 固定ページでテンプレートが選択されているか

**解決手順**:
1. ファイル存在確認
2. テンプレート選択の再設定
3. テーマの再読み込み

### 問題: フォーム送信エラー

**チェックポイント**:
1. [ ] データベーステーブルが作成されているか
2. [ ] 送信先ページが存在するか
3. [ ] PHPエラーが発生していないか

**解決手順**:
1. データベーステーブル確認
2. エラーログの確認
3. wp-config.phpでデバッグ有効化

## ✅ 最終確認チェックリスト

全ての設定が完了したら、以下をチェック：

### システム設定
- [ ] パーマリンクが「投稿名」形式
- [ ] 4つの固定ページが正しく作成されている
- [ ] 各ページに適切なテンプレートが選択されている
- [ ] データベーステーブルが作成されている

### 動作確認
- [ ] 予約フォームページが表示される
- [ ] パラメータ付きURLで予約情報が引き継がれる
- [ ] フォーム入力→確認→完了の画面遷移が動作する
- [ ] JavaScript機能（動的表示、バリデーション）が動作する
- [ ] 印刷画面が別タブで開く

### フォーム機能
- [ ] 見学者分類による動的フォーム表示
- [ ] 旅行会社情報の条件付き表示
- [ ] 交通機関による追加項目表示
- [ ] リアルタイムバリデーション
- [ ] 人数制限チェック（50名）
- [ ] 郵便番号検索機能

## 🎉 完了

全てのチェックが完了すると、予約システムが正常に動作します。
問題がある場合は、該当するトラブルシューティングセクションを参照してください。

## 📞 サポート

設定でお困りの場合は、以下の情報を含めてお問い合わせください：
- 実行したステップ番号
- 発生したエラーメッセージ
- ブラウザのデベロッパーツールのエラー内容
- サーバー環境（PHP版番号、WordPressバージョンなど）